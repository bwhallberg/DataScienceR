---
title: "Data Wrangling"
author: "Brian Hallberg"
date: "5/10/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Initial data loads

Load the data into a data frame and include all the libraries

```{r load,  include=FALSE}
library(readr)
library(tidyr)
library(dplyr)
player_original <- read_csv("Capstone Project/player.csv")
all_star_original <- read_csv("Capstone Project/all_star.csv")
hof_original <- read_csv("Capstone Project/hall_of_fame.csv")
batting <- read_csv("Capstone Project/batting.csv")
pitching <- read_csv("Capstone Project/pitching.csv")
player <- tbl_df(player_original)
all_star <- tbl_df(all_star_original)
hof <- tbl_df(hof_original)
hit <- tbl_df(batting)
pitch <- tbl_df(pitching)
```

## Create some Summary Data sets that will be used to generate the final working data set

As we proceed a little bit of summary data is provided. The set of data for players covers the years 1871-2015 and includes #18,846# names.

There are #1741# players that were selected to at least 1 All-star games.

There are #247# players in the Baseball Hall of Fame in Cooperstown New York.  So #14.2%# of the All-stars and just #1.3%# of all players that have played baseball in over 100 years have become Hall of Famers.


We'll create a summary of the all-star data that is based on the player and how many years they played in the all-star game.  The existing files are by player and year.  I want to know how many years the player made an All-Star game but I don't care which year.

```{r}
sumallstar <- all_star %>%
  select(player_id, league_id, year) %>%
  group_by(player_id) %>%
  count(player_id) %>%
  rename(n=Allstar)
```

Next a list of all the players that have made the Hall of Fame.  The first elections were in 1936 and the last in this data set are were elected in 2016.  The original data file includes players as well as managers, umpires, and executives.  I only care about players.  It also lists all the years when they voted on them for inclusion, but I only care about those that were elected to the hall.

```{r}
sumhof <- hof %>%
  filter(category =="Player") %>%
  select(player_id, inducted) %>%
  filter(inducted == "Y")
```

In this section, I'm reducing the data set of players to those eligible for induction into the hall of fame. The rules say that the player must have played major league baseball for 10 years and they must be out of the game for 5 years.  So we'll reduce the set of players to those that meet those requirements.  There have been exceptions made in the past, but I think that is beyond the scope of this report.

```{r}
fullplay <- player %>%
  mutate(timein = floor(difftime(final_game, debut, units="days")/365)) %>% 
  mutate(Allstar = 0) %>%
  mutate(inducted = "N") %>%
  filter(timein > 10) %>%
  filter(final_game <= "2011-01-01")
```

